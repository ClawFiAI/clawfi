---
import ColorModeSwitcher from '../components/ColorModeSwitcher.astro';
---

<nav class="fixed z-30 w-full glass-nav">
	<div class="px-4 py-3 lg:px-6">
		<div class="flex items-center justify-between">
			<div class="flex items-center gap-4">
				<!-- Mobile menu button -->
				<button
					id="toggleSidebarMobile"
					aria-expanded="true"
					aria-controls="sidebar"
					class="p-2 rounded-xl lg:hidden text-white/60 hover:text-white hover:bg-white/10 transition-all"
				>
					<svg id="toggleSidebarMobileHamburger" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
						<path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
					</svg>
					<svg id="toggleSidebarMobileClose" class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
						<path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
					</svg>
				</button>
				
				<!-- Logo -->
				<a href="/" class="flex items-center">
					<img src="/logo.png" alt="ClawFi" class="h-8 w-auto" />
				</a>

				<!-- Search - Glass pill -->
				<div class="hidden lg:block">
					<div class="relative">
						<div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
							<svg class="w-4 h-4 text-white/40" fill="currentColor" viewBox="0 0 20 20">
								<path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
							</svg>
						</div>
						<input
							type="text"
							id="topbar-search"
							class="input-glass w-80 pl-11 py-2.5 rounded-full text-sm"
							placeholder="Search tokens, wallets..."
						/>
					</div>
				</div>
			</div>

			<div class="flex items-center gap-3">
				<!-- Kill Switch - Glass badge (hidden by default via inline style) -->
				<div id="killswitch-indicator" class="items-center badge-glass badge-glass-red" style="display: none;">
					<span class="status-dot status-dot-offline mr-2"></span>
					<span class="text-sm font-medium">Kill Switch Active</span>
				</div>

				<!-- Mobile Search -->
				<button
					id="toggleSidebarMobileSearch"
					type="button"
					class="p-2 rounded-xl lg:hidden text-white/60 hover:text-white hover:bg-white/10 transition-all"
				>
					<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
						<path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
					</svg>
				</button>

				<!-- Notifications - Glass button -->
				<button
					type="button"
					data-dropdown-toggle="notification-dropdown"
					class="relative p-2.5 rounded-xl text-white/60 hover:text-white hover:bg-white/10 transition-all"
				>
					<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
						<path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path>
					</svg>
					<span id="notification-badge" class="hidden absolute top-1.5 right-1.5 w-2 h-2 bg-[#0A84FF] rounded-full"></span>
				</button>
				
				<!-- Notifications Dropdown - Elevated glass -->
				<div
					class="z-50 hidden max-w-sm glass-elevated overflow-hidden"
					id="notification-dropdown"
				>
					<div class="px-4 py-3 text-sm font-medium text-center border-b border-white/10">
						Recent Signals
					</div>
					<div id="notification-list" class="max-h-64 overflow-y-auto">
						<div class="px-4 py-6 text-sm text-white/40 text-center">
							No new signals
						</div>
					</div>
					<a
						href="/signals"
						class="block py-3 text-sm font-medium text-center text-[#0A84FF] border-t border-white/10 hover:bg-white/5 transition-all"
					>
						View all signals
					</a>
				</div>

				<ColorModeSwitcher />

				<!-- Settings - Glass avatar -->
				<div class="flex items-center ml-1">
					<a
						href="/settings"
						class="flex items-center p-1 rounded-full hover:bg-white/10 transition-all"
					>
						<div class="w-9 h-9 rounded-full bg-gradient-to-br from-[#0A84FF] to-[#5856D6] flex items-center justify-center text-white font-semibold text-sm shadow-lg shadow-blue-500/30">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
								<path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
								<circle cx="12" cy="12" r="3"/>
							</svg>
						</div>
					</a>
				</div>
			</div>
		</div>
	</div>
</nav>

<script>
	// ClawFi runs in appliance mode - no authentication required
	// Check kill switch status (public endpoint)
	fetch('https://api.clawfi.ai/risk/policy')
		.then(res => res.json())
		.then(data => {
			const indicator = document.getElementById('killswitch-indicator');
			if (indicator && data.success && data.data) {
				if (data.data.killSwitchActive) {
					indicator.style.display = 'inline-flex';
				} else {
					indicator.style.display = 'none';
				}
			}
		})
		.catch(() => {});
</script>
